name: Run Cypress E2E Tests

on: [push, pull_request]

jobs:
  cypress-run:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'  # Updated to use Node.js version 20

    - name: Install Dependencies with npm ci
      run: npm ci  # Using npm ci for a cleaner, more reliable install based on package-lock.json

    - name: Cache Cypress binary
      uses: actions/cache@v3
      with:
        path: ~/.cache/Cypress
        key: ${{ runner.os }}-cypress-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-cypress-

    - name: Run Cypress Tests
      uses: cypress-io/github-action@v3
      with:
        start: npm run dev # Command to start your server, if needed
        wait-on: 'http://localhost:8888' # Adjust the URL/port as necessary
        wait-on-timeout: 300 # seconds to wait for your server to start
        config: video=true # Enable video recording of the test runs
        working-directory: ./cypress/e2e # Specify if your cypress.json is in a different folder
